#!/usr/bin/env bash

set -o errexit
set -o nounset

HERE=$(cd `dirname "${BASH_SOURCE[0]}"` && pwd)

PANTS_VERSION=0.0.18
if ! [[ -e "$HERE/pants-$PANTS_VERSION.pex" ]]; then
  echo "Building pants.pex @ $PANTS_VERSION"
  "$HERE/pex" \
    --requirement "twitter.pants==$PANTS_VERSION" \
    --entry-point twitter.pants.bin.pants_exe:main \
    -p "$HERE/pants-$PANTS_VERSION.pex.tmp"
  mv "$HERE/pants-$PANTS_VERSION.pex.tmp" "$HERE/pants-$PANTS_VERSION.pex"  # 2PC
  echo "Built pants-$PANTS_VERSION.pex"
fi

exec "$HERE/pants-$PANTS_VERSION.pex" "$@"
